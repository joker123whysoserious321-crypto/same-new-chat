<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Your Site Chat</title>
    <style>
      body { font-family: system-ui, sans-serif; display:grid; grid-template-columns: 260px 1fr; gap:16px; max-width: 1100px; margin: 24px auto; }
      aside { border:1px solid #ddd; border-radius:12px; padding:12px; height: calc(100vh - 80px); overflow:auto; }
      main { border:1px solid #ddd; border-radius:12px; padding:12px; height: calc(100vh - 80px); display:flex; flex-direction:column; }
      #log { flex:1; overflow:auto; }
      .row { display:flex; gap:8px; margin-top:12px; }
      input { flex:1; padding:12px; border:1px solid #ccc; border-radius:12px; }
      button { padding:12px 16px; border-radius:12px; background:#000; color:#fff; border:none; }
      .msg { margin:8px 0; }
      .you .bubble { background:#000; color:#fff; }
      .ai .bubble  { background:#f2f2f2; }
      .bubble { display:inline-block; padding:10px 14px; border-radius:16px; }
      small { color:#666; }
    </style>
  </head>
  <body>
    <aside>
      <h3>Conversations</h3>
      <div>(MVP) demo-conv-1</div>
      <p><small>Answers use our private knowledge base only.</small></p>
    </aside>
    <main>
      <div id="log"></div>
      <div class="row">
        <input id="msg" placeholder="Messageâ€¦" />
        <button id="send">Send</button>
      </div>
    </main>
    <script>
      const log = document.getElementById('log');
      const msg = document.getElementById('msg');
      const user_id = 'demo-user-1';
      const conversation_id = 'demo-conv-1';

      function add(role, text){
        const div = document.createElement('div');
        div.className = `msg ${role}`;
        div.innerHTML = `<span class="bubble"><b>${role==='you'?'You':'AI'}:</b> ${text}</span>`;
        log.appendChild(div);
        log.scrollTop = log.scrollHeight;
      }

      async function send(){
        const text = msg.value.trim(); if(!text) return;
        add('you', text); msg.value = '';
        const r = await fetch('/api/chat', {
          method:'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: text, user_id, conversation_id })
        });
        const j = await r.json();
        add('ai', j.reply);
      }

      document.getElementById('send').onclick = send;
      msg.addEventListener('keydown', e => { if(e.key==='Enter') send(); });
    </script>
  </body>
</html>
